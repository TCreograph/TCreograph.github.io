import{colors as S,fs as D}from"@vuepress/utils";import{Logger as J,isAbsoluteUrl as O,isUrl as $,getAuthor as _,getDate as E,stripTags as R,getPageText as M}from"vuepress-shared/node";import{isString as L,isLinkHttp as q,removeEndingSlash as x,removeLeadingSlash as W,isArray as z,isFunction as K}from"@vuepress/shared";const p=new J("vuepress-plugin-seo2"),C=(t,e)=>Object.entries(e).map(([a,o])=>({localePath:a,lang:o.lang})).filter(a=>L(a.lang)&&a.lang!==t),T=({frontmatter:t},{hostname:e},{options:{base:a}})=>{const{banner:o,cover:n}=t;if(o){if(O(o))return v(e,a,o);if($(o))return o}if(n){if(O(n))return v(e,a,n);if($(n))return n}return null},U=({content:t},{hostname:e},{options:{base:a}})=>{const o=/!\[.*?\]\((.*?)\)/giu.exec(t);return o?o.map(([,n])=>O(n)?v(e,a,n):$(n)?n:null).filter(n=>n!==null):[]},v=(t,e,a)=>`${q(t)?x(t):`https://${x(t)}`}${e}${W(a)}`,j=(t,e,a="",o="")=>{e in t&&(p.error(`"${S.magenta(e)}" is ${S.red("removed")}${o?`, please use ${S.magenta(o)} instead.`:" and no longer supported"}${a?`
${a}`:""}`),o||delete t[e])},Q=t=>{j(t,"seo","","ogp"),j(t,"customMeta","","customHead")},V=(t,e,a)=>{var o,n,i;const{isArticle:r=c=>Boolean(c.filePathRelative&&!c.frontmatter.home)}=e,{options:{base:d},siteData:s}=a,{frontmatter:{author:g,time:b,date:m=b,tag:u,tags:h=u},data:{git:f={}}}=t,l=((o=s.locales[t.pathLocale])==null?void 0:o.title)||s.title||((n=s.locales["/"])==null?void 0:n.title)||"",B=g===!1?[]:_(g||e.author),{updatedTime:P}=f,k=P?new Date(P).toISOString():"",G=z(h)?h:L(u)?[u]:[],y=t.title,H=T(t,e,a),N=U(t,e,a),F=C(t.lang,s.locales);let w="";if(m instanceof Date)w=new Date(m).toISOString();else if(m){const c=E(m);c&&c.value&&(w=c.value.toISOString())}const A=H||N[0]||e.fallBackImage||"";return{"og:url":v(e.hostname,d,t.path),"og:site_name":l,"og:title":y,"og:description":t.frontmatter.description||"","og:type":r(t)?"article":"website","og:image":A,"og:updated_time":k,"og:locale":t.lang,"og:locale:alternate":F.map(({lang:c})=>c),...e.restrictions?{"og:restrictions:age":e.restrictions}:{},...e.twitterID?{"twitter:creator":e.twitterID}:{},...A?{"twitter:card":"summary_large_image","twitter:image:alt":y}:{},"article:author":(i=B[0])==null?void 0:i.name,"article:tag":G,"article:published_time":w,"article:modified_time":k}},X=(t,e,a)=>{const{isArticle:o=l=>Boolean(l.filePathRelative&&!l.frontmatter.home)}=e,{frontmatter:{author:n,time:i,date:r=i},data:{git:d={}}}=t,s=n===!1?[]:_(n||e.author),{updatedTime:g}=d,b=g?new Date(g).toISOString():"",m=t.title,u=T(t,e,a),h=U(t,e,a);let f="";if(r instanceof Date)f=new Date(r).toISOString();else if(r){const l=E(r);l&&l.value&&(f=l.value.toISOString())}return o(t)?{"@context":"https://schema.org","@type":"NewsArticle",headline:m,image:h.length?h:[u||e.fallBackImage||""],datePublished:f,dateModified:b,author:s.map(l=>({"@type":"Person",...l}))}:null},Y=(t,e)=>K(e.canonical)?e.canonical(t):L(e.canonical)?`${x(e.canonical)}${t.path}`:null,Z=(t,{hostname:e},{options:a,siteData:o})=>C(t.lang,o.locales).map(({lang:n,localePath:i})=>({lang:n,path:v(e,a.base,`${i}${t.path.replace(t.pathLocale,"")}`)})),I=(t,{name:e,content:a,attribute:o=["article:","og:"].some(n=>e.startsWith(n))?"property":"name"})=>{a&&t.push(["meta",{[o]:e,content:a}])},tt=(t,e)=>{for(const a in e)switch(a){case"article:tag":e["article:tag"].forEach(o=>I(t,{name:"article:tag",content:o}));break;case"og:locale:alternate":e["og:locale:alternate"].forEach(o=>{o!==e["og:locale"]&&I(t,{name:"og:locale:alternate",content:o})});break;default:e[a]&&I(t,{name:a,content:e[a]})}},et=(t,e)=>{e&&t.push(["script",{type:"application/ld+json"},JSON.stringify(e)])},at=(t,e)=>{e&&t.push(["link",{rel:"canonical",href:e}])},ot=(t,e)=>{e.forEach(({lang:a,path:o})=>{t.push(["link",{rel:"alternate",hreflang:a.toLowerCase(),href:o}])})},nt=(t,e,a)=>{const o=t.frontmatter.head||[],n=V(t,e,a),i=X(t,e,a),r=e.ogp?e.ogp(n,t,a):n,d=e.jsonLd?e.jsonLd(i,t,a):null,s=Y(t,e),g=Z(t,e,a);tt(o,r),et(o,d),at(o,s),ot(o,g),e.customHead&&e.customHead(o,t,a),t.frontmatter.head=o},rt=async t=>{p.load("Generating robots.txt");const e=t.public("robots.txt");let a=D.existsSync(e)?await D.readFile(e,{encoding:"utf8"}):"";a&&!a.includes("User-agent")?(p.error(),p.update("robots.txt seems invalid!")):(a+=`
User-agent:*
Disallow:
`,await D.writeFile(t.dest("robots.txt"),a,{flag:"w"}),p.succeed())},it=(t,e=!1)=>a=>{e&&Q(t),a.env.isDebug&&p.info("Options:",t);const o={name:"vuepress-plugin-seo2"};return t.hostname?{...o,extendsPage:(n,i)=>{if(!n.frontmatter.description&&t.autoDescription!==!1){if(n.data.excerpt)n.frontmatter.description=R(n.data.excerpt).replace(/(?:\r?\n)+/g," ").replace(/ +/g," ").trim();else{const r=M(n);n.frontmatter.description=r.length>180?`${r.slice(0,177)}...`:r}n.data.autoDesc=!0}nt(n,t,i)},onGenerated:n=>rt(n.dir)}:(p.error(`Option ${S.magenta("hostname")} is required!`),o)};export{it as seoPlugin};
//# sourceMappingURL=index.js.map
