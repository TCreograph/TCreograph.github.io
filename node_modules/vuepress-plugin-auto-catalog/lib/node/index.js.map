{"version":3,"file":"index.js","sources":["../../src/node/utils.ts","../../src/node/autoCatalog.ts","../../src/node/locales.ts","../../src/node/plugin.ts"],"sourcesContent":["import { ensureEndingSlash } from \"@vuepress/shared\";\nimport { getDirname, path } from \"@vuepress/utils\";\nimport { Logger } from \"vuepress-shared/node\";\n\nconst __dirname = getDirname(import.meta.url);\n\nexport const logger = new Logger(\"vuepress-plugin-auto-catalog\");\n\nexport const CLIENT_FOLDER = ensureEndingSlash(\n  path.resolve(__dirname, \"../client\")\n);\n","import { createPage } from \"@vuepress/core\";\nimport { getTitleFromFilename } from \"vuepress-shared/node\";\nimport { logger } from \"./utils.js\";\n\nimport type { App, PageFrontmatter } from \"@vuepress/core\";\nimport type { AutoCatalogOptions } from \"./options.js\";\n\nexport const generateCatalog = async (\n  app: App,\n  {\n    component = \"AutoCatalog\",\n    exclude = [],\n    frontmatter = (): PageFrontmatter => ({}),\n    level = 3,\n  }: AutoCatalogOptions\n): Promise<void> => {\n  const {\n    env: { isDebug },\n    pages,\n  } = app;\n\n  const pathToBeGenerated = new Set<string>();\n  const content = `\\\n<${component}${[1, 2].includes(level) ? ` :level=\"${level}\"` : \"\"} />\n`;\n\n  pages.forEach(({ path: pagePath, pathLocale }) => {\n    let catalogPath = pagePath;\n\n    while (catalogPath !== pathLocale) {\n      catalogPath = catalogPath.replace(/\\/(?:[^/]+\\/?)$/, \"/\");\n\n      if (\n        // not discovered yet\n        !pathToBeGenerated.has(catalogPath) &&\n        // not being excluded\n        exclude.every((pattern) => !catalogPath.match(pattern)) &&\n        // path not found\n        pages.every(({ path }) => path !== catalogPath)\n      ) {\n        if (isDebug) logger.info(`Generating catalog ${catalogPath}}`);\n\n        pathToBeGenerated.add(catalogPath);\n      }\n    }\n  });\n\n  await Promise.all(\n    Array.from(pathToBeGenerated)\n      .map((path) => decodeURI(path))\n      .map((path) => {\n        const [, basename] = /\\/([^/]+)\\/?$/.exec(path) || [];\n        const title = getTitleFromFilename(basename);\n\n        return createPage(app, {\n          frontmatter: {\n            title,\n            ...(frontmatter(path) || {}),\n          },\n          content,\n          path,\n        });\n      })\n  ).then((pages) => {\n    app.pages.push(...pages);\n  });\n};\n","import type { AutoCatalogLocaleConfig } from \"../shared/index.js\";\n\nexport const locales: AutoCatalogLocaleConfig = {\n  \"/en/\": {\n    title: \"Catalog\",\n  },\n\n  \"/zh/\": {\n    title: \"目录\",\n  },\n\n  \"/zh-tw/\": {\n    title: \"目錄\",\n  },\n\n  \"/de/\": {\n    title: \"Katalog\",\n  },\n\n  \"/de-at/\": {\n    title: \"Katalog\",\n  },\n\n  \"/vi/\": {\n    title: \"Danh mục\",\n  },\n\n  \"/uk/\": {\n    title: \"Каталог\",\n  },\n\n  \"/ru/\": {\n    title: \"Каталог\",\n  },\n\n  \"/br/\": {\n    title: \"Catálogo\",\n  },\n\n  \"/pl/\": {\n    title: \"Katalog\",\n  },\n\n  \"/sk/\": {\n    title: \"Katalóg\",\n  },\n\n  \"/fr/\": {\n    title: \"Catalogue\",\n  },\n\n  \"/es/\": {\n    title: \"Catálogo\",\n  },\n\n  \"/ja/\": {\n    title: \"カタログ\",\n  },\n\n  \"/tr/\": {\n    title: \"Katalog\",\n  },\n\n  \"/ko/\": {\n    title: \"목차\",\n  },\n\n  \"/fi/\": {\n    title: \"Luettelo\",\n  },\n};\n","import { getLocales } from \"vuepress-shared/node\";\nimport { useSassPalettePlugin } from \"vuepress-plugin-sass-palette\";\n\nimport { generateCatalog } from \"./autoCatalog.js\";\nimport { locales as defaultLocales } from \"./locales.js\";\nimport { CLIENT_FOLDER, logger } from \"./utils.js\";\n\nimport type { PageFrontmatter, PluginFunction } from \"@vuepress/core\";\nimport type { AutoCatalogOptions } from \"./options.js\";\n\nexport const autoCatalogPlugin =\n  (options: AutoCatalogOptions = {}): PluginFunction =>\n  (app) => {\n    if (app.env.isDebug) logger.info(\"Options:\", options);\n\n    useSassPalettePlugin(app, { id: \"hope\" });\n\n    const {\n      component,\n      exclude = [],\n      frontmatter = (): PageFrontmatter => ({}),\n      getIcon,\n      iconRouteMetaKey = \"i\",\n      getIndex,\n      indexRouteMetaKey = \"I\",\n      level = 3,\n      locales,\n      getOrder,\n      orderRouteMetaKey = \"O\",\n      getTitle,\n      titleRouteMetaKey = \"title\",\n    } = options;\n\n    return {\n      name: \"vuepress-plugin-auto-catalog\",\n\n      define: (): Record<string, unknown> => ({\n        AUTO_CATALOG_LOCALES: getLocales({\n          app,\n          name: \"auto-catalog\",\n          default: defaultLocales,\n          config: locales,\n        }),\n        AUTO_CATALOG_TITLE_META_KEY: titleRouteMetaKey,\n        AUTO_CATALOG_ICON_META_KEY: iconRouteMetaKey,\n        AUTO_CATALOG_ORDER_META_KEY: orderRouteMetaKey,\n        AUTO_CATALOG_INDEX_META_KEY: indexRouteMetaKey,\n      }),\n\n      extendsPage: (page): void => {\n        if (!component) {\n          const data: Record<string, unknown> = {};\n\n          const pageTitle = getTitle?.(page);\n          const pageIcon = getIcon?.(page);\n          const pageOrder = getOrder?.(page);\n          const pageIndex = getIndex?.(page);\n\n          if (pageTitle) data[titleRouteMetaKey] = pageTitle;\n          if (pageIcon) data[iconRouteMetaKey] = pageIcon;\n          if (pageIndex !== false) data[indexRouteMetaKey] = 1;\n          if (pageOrder !== null) data[orderRouteMetaKey] = pageOrder;\n\n          page.routeMeta = { ...page.routeMeta, ...data };\n        }\n      },\n\n      onInitialized: async (app): Promise<void> =>\n        generateCatalog(app, { exclude, frontmatter, level }),\n\n      ...(component ? {} : { clientConfigFile: `${CLIENT_FOLDER}config.js` }),\n    };\n  };\n"],"names":["__dirname","getDirname","logger","Logger","CLIENT_FOLDER","ensureEndingSlash","path","generateCatalog","app","component","exclude","frontmatter","level","isDebug","pages","pathToBeGenerated","content","pagePath","pathLocale","catalogPath","pattern","basename","title","getTitleFromFilename","createPage","locales","autoCatalogPlugin","options","useSassPalettePlugin","getIcon","iconRouteMetaKey","getIndex","indexRouteMetaKey","getOrder","orderRouteMetaKey","getTitle","titleRouteMetaKey","getLocales","defaultLocales","page","data","pageTitle","pageIcon","pageOrder","pageIndex"],"mappings":"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"}