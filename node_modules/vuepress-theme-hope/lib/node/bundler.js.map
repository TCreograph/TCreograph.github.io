{"version":3,"file":"bundler.js","sourceRoot":"","sources":["../../src/node/bundler.ts"],"names":[],"mappings":"AAAA,OAAO,EACL,aAAa,EACb,0BAA0B,EAC1B,0BAA0B,EAC1B,cAAc,EACd,OAAO,GACR,MAAM,sBAAsB,CAAC;AAM9B;;;;;;GAMG;AACH,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAC,cAAuB,EAAE,GAAQ,EAAQ,EAAE;IAClE,MAAM,WAAW,GAAG,cAAc,CAAC,GAAG,CAAC,CAAC;IAExC,WAAW;IACX,IAAI,WAAW,KAAK,MAAM,EAAE;QAC1B,MAAM,iBAAiB,GAAuB,cAAc,CAAC;QAE7D,IAAI,CAAC,iBAAiB,CAAC,gBAAgB;YACrC,iBAAiB,CAAC,gBAAgB,GAAG,EAAE,CAAC;QAE1C,IAAI,CAAC,iBAAiB,CAAC,gBAAgB,CAAC,QAAQ;YAC9C,iBAAiB,CAAC,gBAAgB,CAAC,QAAQ,GAAG,EAAE,CAAC;QAEnD,IAAI,CAAC,iBAAiB,CAAC,gBAAgB,CAAC,QAAQ,CAAC,eAAe;YAC9D,iBAAiB,CAAC,gBAAgB,CAAC,QAAQ,CAAC,eAAe,GAAG,EAAE,CAAC;QAEnE,MAAM,EAAE,eAAe,EAAE,GACvB,iBAAiB,CAAC,gBAAgB,CAAC,QAAQ,CAAC,eAAe,CAAC;QAE9D,iBAAiB,CAAC,gBAAgB,CAAC,QAAQ,CAAC,eAAe,CAAC,eAAe;YACzE,CAAC,GAAW,EAAkB,EAAE;gBAC9B,IAAI,eAAe,EAAE;oBACnB,MAAM,MAAM,GAAG,eAAe,CAAC,GAAG,CAAC,CAAC;oBAEpC,IAAI,CAAC,MAAM;wBAAE,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;oBAE3C,OAAO,MAAM,CAAC;iBACf;gBAED,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;YAChC,CAAC,CAAC;KACL;IAED,cAAc;SACT,IAAI,WAAW,KAAK,SAAS,EAAE;QAClC,MAAM,oBAAoB,GAAG,cAAuC,CAAC;QAErE,IAAI,CAAC,oBAAoB,CAAC,GAAG;YAAE,oBAAoB,CAAC,GAAG,GAAG,EAAE,CAAC;QAC7D,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,eAAe;YAC3C,oBAAoB,CAAC,GAAG,CAAC,eAAe,GAAG,EAAE,CAAC;QAEhD,MAAM,EAAE,eAAe,EAAE,GAAG,oBAAoB,CAAC,GAAG,CAAC,eAAe,CAAC;QAErE,oBAAoB,CAAC,GAAG,CAAC,eAAe,CAAC,eAAe,GAAG,CACzD,GAAW,EACK,EAAE;YAClB,IAAI,eAAe,EAAE;gBACnB,MAAM,MAAM,GAAG,eAAe,CAAC,GAAG,CAAC,CAAC;gBAEpC,IAAI,CAAC,MAAM;oBAAE,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;gBAE3C,OAAO,MAAM,CAAC;aACf;YAED,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAChC,CAAC,CAAC;KACH;AACH,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,qBAAqB,GAAG,CACnC,cAAuB,EACvB,GAAQ,EACF,EAAE;IACR,aAAa,CAAC,cAAc,EAAE,GAAG,EAAE;QACjC,KAAK,EAAE;YACL,qBAAqB,EAAE,IAAI;SAC5B;KACF,CAAC,CAAC;IACH,0BAA0B,CAAC,cAAc,EAAE,GAAG,EAAE,cAAc,CAAC,CAAC;IAChE,0BAA0B,CAAC,cAAc,EAAE,GAAG,EAAE,aAAa,CAAC,CAAC;IAE/D,QAAQ,CAAC,cAAc,EAAE,GAAG,CAAC,CAAC;AAChC,CAAC,CAAC","sourcesContent":["import {\n  addViteConfig,\n  addViteOptimizeDepsExclude,\n  addViteOptimizeDepsInclude,\n  getBundlerName,\n  tagHint,\n} from \"vuepress-shared/node\";\n\nimport type { App } from \"@vuepress/core\";\nimport type { ViteBundlerOptions } from \"@vuepress/bundler-vite\";\nimport type { WebpackBundlerOptions } from \"@vuepress/bundler-webpack\";\n\n/**\n * Add tags as customElement\n *\n * @param bundlerOptions VuePress Bundler config\n * @param app VuePress Node App\n * @param customElements tags recognized as custom element\n */\nexport const checkTag = (bundlerOptions: unknown, app: App): void => {\n  const bundlerName = getBundlerName(app);\n\n  // for vite\n  if (bundlerName === \"vite\") {\n    const viteBundlerConfig = <ViteBundlerOptions>bundlerOptions;\n\n    if (!viteBundlerConfig.vuePluginOptions)\n      viteBundlerConfig.vuePluginOptions = {};\n\n    if (!viteBundlerConfig.vuePluginOptions.template)\n      viteBundlerConfig.vuePluginOptions.template = {};\n\n    if (!viteBundlerConfig.vuePluginOptions.template.compilerOptions)\n      viteBundlerConfig.vuePluginOptions.template.compilerOptions = {};\n\n    const { isCustomElement } =\n      viteBundlerConfig.vuePluginOptions.template.compilerOptions;\n\n    viteBundlerConfig.vuePluginOptions.template.compilerOptions.isCustomElement =\n      (tag: string): boolean | void => {\n        if (isCustomElement) {\n          const result = isCustomElement(tag);\n\n          if (!result) tagHint(tag, app.env.isDebug);\n\n          return result;\n        }\n\n        tagHint(tag, app.env.isDebug);\n      };\n  }\n\n  // for webpack\n  else if (bundlerName === \"webpack\") {\n    const webpackBundlerConfig = bundlerOptions as WebpackBundlerOptions;\n\n    if (!webpackBundlerConfig.vue) webpackBundlerConfig.vue = {};\n    if (!webpackBundlerConfig.vue.compilerOptions)\n      webpackBundlerConfig.vue.compilerOptions = {};\n\n    const { isCustomElement } = webpackBundlerConfig.vue.compilerOptions;\n\n    webpackBundlerConfig.vue.compilerOptions.isCustomElement = (\n      tag: string\n    ): boolean | void => {\n      if (isCustomElement) {\n        const result = isCustomElement(tag);\n\n        if (!result) tagHint(tag, app.env.isDebug);\n\n        return result;\n      }\n\n      tagHint(tag, app.env.isDebug);\n    };\n  }\n};\n\nexport const extendsBundlerOptions = (\n  bundlerOptions: unknown,\n  app: App\n): void => {\n  addViteConfig(bundlerOptions, app, {\n    build: {\n      chunkSizeWarningLimit: 1024,\n    },\n  });\n  addViteOptimizeDepsInclude(bundlerOptions, app, \"@vueuse/core\");\n  addViteOptimizeDepsExclude(bundlerOptions, app, \"@theme-hope\");\n\n  checkTag(bundlerOptions, app);\n};\n"]}