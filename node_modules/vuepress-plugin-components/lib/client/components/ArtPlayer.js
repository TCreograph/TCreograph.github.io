import{usePageLang as k}from"@vuepress/client";import{ref as v,computed as z,unref as g,onMounted as b,isRef as N,watch as A,defineComponent as M,nextTick as L,onBeforeUnmount as R,h as x,camelize as S}from"vue";import{keys as D}from"vuepress-shared/client";import{isString as P}from"@vuepress/shared";import{useEventListener as T}from"@vueuse/core";const E=e=>P(e)?e:`${e}px`,O=(e,t=0)=>{const a=v(),r=z(()=>E(g(e.width)||"100%")),n=v("auto"),c=i=>{if(P(i)){const[l,y]=i.split(":"),o=Number(l)/Number(y);if(!Number.isNaN(o))return o}return typeof i=="number"?i:16/9},p=i=>{const l=g(e.height),y=c(g(e.ratio));return l?E(l):`${Number(i)/y+g(t)}px`},u=()=>{a.value&&(n.value=p(a.value.clientWidth))};return b(()=>{u(),N(t)&&A(t,()=>u()),T("orientationchange",()=>u()),T("resize",()=>u())}),{el:a,width:r,height:n}},U=["mp4","mp3","webm","ogg","m3u8","hls","ts","flv","mpd","dash"],_=e=>(e==null?void 0:e.split(".").pop())||"",C=async(e,t,a,r=!1,n=0)=>{const c=(await import("dashjs/dist/dash.all.min.js")).default;if(c.supportsMediaSource()){const p=c.MediaPlayer().create();p.initialize(e,t,r,n),a(()=>p.destroy())}},B=async(e,t,a)=>{const r=(await import("mpegts.js/dist/mpegts.js")).default;if(r.isSupported()){const n=r.createPlayer({type:"flv",url:t});n.attachMediaElement(e),n.load(),a(()=>n.destroy())}},I=async(e,t,a)=>{const r=(await import("hls.js/dist/hls.min.js")).default;if(e.canPlayType("application/x-mpegURL")||e.canPlayType("application/vnd.apple.mpegURL"))e.src=t;else if(r.isSupported()){const n=new r;n.attachMedia(e),n.on(r.Events.MEDIA_ATTACHED,function(){n.loadSource(t)}),a(()=>n.destroy())}},$=["no-fullscreen","no-hotkey","no-playback-rate","no-setting","no-mutex","no-plays-inline"],F=["airplay","autoplay","aspect-ratio","auto-mini","auto-size","auto-orientation","auto-playback","fast-forward","flip","fullscreen-web","lock","loop","is-live","muted","mini-progress-bar","pip","screenshot","subtitle-offset"],H=["en","pl","cs","es","fa"],Y=["zh-cn","zh-tw"],j=e=>{const t=e.toLowerCase(),a=t.split("-")[0];return Y.includes(t)?t:H.includes(a)?a:a==="zh"?"zh-cn":"en"};var q=M({name:"ArtPlayer",props:{src:{type:String,required:!0},type:{type:String,default:""},poster:{type:String,default:""},title:{type:String,default:""},width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:void 0},ratio:{type:[String,Number],default:16/9},config:{type:Object,default:null},customPlayer:{type:Function,default:e=>e}},setup(e,{attrs:t}){const a=k(),{el:r,width:n,height:c}=O(e,0);let p;const u=()=>{var i,l,y;const o={theme:"#3eaf7c",...ART_PLAYER_OPTIONS,container:r.value,title:e.title,poster:e.poster,url:e.src,type:e.type||_(e.src),lang:j(a.value),...e.config,useSSR:!1},w=D(t);if($.forEach(s=>{w.includes(s)&&(o[S(s.replace(/^no-/,""))]=!1)}),F.forEach(s=>{w.includes(s)&&(o[S(s)]=!0)}),o.type){const s=o.customType??(o.customType={});if(U.includes(o.type.toLowerCase()))switch(o.type){case"m3u8":case"hls":s[i=o.type]??(s[i]=(d,f,m)=>I(d,f,h=>{m.on("destroy",h)}));break;case"flv":s[l=o.type]??(s[l]=(d,f,m)=>B(d,f,h=>{m.on("destroy",h)}));break;case"mpd":case"dash":s[y=o.type]??(s[y]=(d,f,m)=>C(d,f,h=>{m.on("destroy",h)}));break}else console.warn(`[components]: ArtPlayer does not support current file type ${o.type}!`)}return o};return b(()=>{import("artplayer").then(async({default:i})=>L().then(async()=>{const l=new i(u());p=await e.customPlayer(l)||l}))}),R(()=>{p==null||p.destroy()}),()=>x("div",{ref:r,style:{width:n.value,height:c.value}},"Loading...")}});export{q as default};
//# sourceMappingURL=ArtPlayer.js.map
