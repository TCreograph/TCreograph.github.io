{"version":3,"file":"Catalog.js","sources":["../../../src/client/components/FontIcon.ts","../../../src/client/components/Catalog.ts"],"sourcesContent":["import { computed, defineComponent, h } from \"vue\";\nimport type { VNode } from \"vue\";\n\nimport \"../styles/font-icon.scss\";\n\ndeclare const ICON_PREFIX: string;\n\nexport default defineComponent({\n  name: \"FontIcon\",\n\n  props: {\n    /**\n     * Icon class\n     *\n     * 图标类名\n     */\n    icon: { type: String, default: \"\" },\n    /**\n     * Icon color\n     *\n     * 图标颜色\n     */\n    color: { type: String, default: \"\" },\n\n    /**\n     * Icon size\n     *\n     * 图标大小\n     */\n    size: {\n      type: [String, Number],\n      default: \"\",\n    },\n  },\n\n  setup(props) {\n    const style = computed(() => {\n      const styleObject: Record<string, string> = {};\n\n      if (props.color) {\n        styleObject[\"color\"] = props.color;\n      }\n\n      if (props.size) {\n        styleObject[\"font-size\"] = Number.isNaN(Number(props.size))\n          ? <string>props.size\n          : `${props.size}px`;\n      }\n\n      return Object.keys(styleObject).length ? styleObject : null;\n    });\n\n    return (): VNode | null =>\n      props.icon\n        ? h(\"span\", {\n            class: [\"font-icon icon\", `${ICON_PREFIX}${props.icon}`],\n            style: style.value,\n          })\n        : null;\n  },\n});\n","import { useSiteData } from \"@vuepress/client\";\nimport { computed, defineComponent, h } from \"vue\";\nimport { RouterLink, useRoute, useRouter } from \"vue-router\";\nimport { useLocaleConfig } from \"vuepress-shared/client\";\n\nimport FontIcon from \"./FontIcon.js\";\n\nimport type { PropType, VNode } from \"vue\";\nimport type { RouteMeta } from \"vue-router\";\nimport type { CatalogLocaleConfig } from \"../../shared/locales.js\";\n\nimport \"../styles/catalog.scss\";\n\ndeclare const CATALOG_LOCALES: CatalogLocaleConfig;\n\ninterface CatalogInfo {\n  title: string;\n  icon: string;\n  base: string;\n  order: number;\n  level: number;\n  path: string;\n  children?: CatalogInfo[];\n}\n\nexport default defineComponent({\n  // eslint-disable-next-line vue/multi-word-component-names\n  name: \"Catalog\",\n\n  props: {\n    /**\n     * Catalog Base\n     *\n     * 目录的基础路径\n     *\n     * @default current route base\n     */\n    base: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Max level of catalog\n     *\n     * @description only 1,2,3 are supported\n     *\n     * Catalog 的最大层级\n     *\n     * @description 目前仅支持 1,2,3\n     *\n     * @default 3\n     */\n    level: {\n      type: Number,\n      default: 3,\n    },\n\n    /**\n     * Page title getter\n     *\n     * 页面标题获取器\n     */\n    titleGetter: {\n      type: Function as PropType<(meta: RouteMeta) => string>,\n      default: (meta: RouteMeta) => meta[\"title\"],\n    },\n\n    /**\n     * Page icon getter\n     *\n     * 页面图标获取器\n     */\n    iconGetter: {\n      type: Function as PropType<(meta: RouteMeta) => string>,\n      default: (meta: RouteMeta) => meta[\"icon\"],\n    },\n\n    /**\n     * Page order getter\n     *\n     * 页面排序获取器\n     */\n    orderGetter: {\n      type: Function as PropType<(meta: RouteMeta) => number>,\n      default: (meta: RouteMeta) => meta[\"order\"] || 0,\n    },\n\n    /**\n     * Whether page should be indexed\n     *\n     * 页面是否应该被索引\n     */\n    shouldIndex: {\n      type: Function as PropType<(meta: RouteMeta) => boolean>,\n      default: (meta: RouteMeta) => meta[\"index\"] !== false,\n    },\n  },\n\n  setup(props) {\n    const locale = useLocaleConfig(CATALOG_LOCALES);\n    const route = useRoute();\n    const router = useRouter();\n    const siteData = useSiteData();\n\n    const getCatalogInfo = (): CatalogInfo[] => {\n      const base = props.base || route.path.replace(/\\/[^/]+$/, \"/\");\n      const routes = router.getRoutes();\n      const result: CatalogInfo[] = [];\n\n      routes\n        .filter(({ meta, path }) => {\n          // filter those under current base\n          if (!path.startsWith(base) || path === base) return false;\n\n          if (base === \"/\") {\n            const otherLocales = Object.keys(siteData.value.locales).filter(\n              (item) => item !== \"/\"\n            );\n\n            // exclude 404 page and other locales\n            if (\n              path === \"/404.html\" ||\n              otherLocales.some((localePath) => path.startsWith(localePath))\n            )\n              return false;\n          }\n\n          return (\n            // filter real page\n            ((path.endsWith(\".html\") && !path.endsWith(\"/index.html\")) ||\n              path.endsWith(\"/\")) &&\n            // page should be indexed\n            props.shouldIndex(meta)\n          );\n        })\n        .map(({ path, meta }) => {\n          const level = path.substring(base.length).split(\"/\").length;\n\n          return {\n            title: props.titleGetter(meta),\n            icon: props.iconGetter(meta),\n            base: path.replace(/\\/[^/]+\\/?$/, \"/\"),\n            order: props.orderGetter(meta),\n            level: path.endsWith(\"/\") ? level - 1 : level,\n            path,\n          };\n        })\n        .filter(({ title, level }) => level <= props.level || !title)\n        .sort((infoA, infoB) => {\n          const level = infoA.level - infoB.level;\n\n          if (level) return level;\n\n          // check README.md, it should be first one\n          if (infoA.path.endsWith(\"/index.html\")) return -1;\n          if (infoB.path.endsWith(\"/index.html\")) return 1;\n\n          // infoA order is absent\n          if (infoA.order === null) {\n            // infoB order is absent\n            if (infoB.order === null)\n              // compare title\n              return infoA.title.localeCompare(infoB.title);\n\n            // infoB order is present\n            return infoB.order;\n          }\n\n          // infoB order is absent\n          if (infoB.order === null) return infoA.order;\n\n          // now we are sure both order exist\n\n          // infoA order is positive\n          if (infoA.order > 0) {\n            if (infoB.order > 0) return infoA.order - infoB.order;\n\n            return -1;\n          }\n\n          // both order are negative\n          if (infoB.order < 0) return infoA.order - infoB.order;\n\n          return 1;\n        })\n        .forEach((info) => {\n          const { base, level } = info;\n\n          switch (level) {\n            case 1:\n              result.push(info);\n              break;\n\n            case 2: {\n              const parent = result.find((item) => item.path === base);\n\n              if (parent) (parent.children ??= []).push(info);\n              break;\n            }\n\n            default: {\n              const grandParent = result.find(\n                (item) => item.path === base.replace(/\\/[^/]+\\/$/, \"/\")\n              );\n\n              if (grandParent) {\n                const parent = grandParent.children?.find(\n                  (item) => item.path === base\n                );\n\n                if (parent) (parent.children ??= []).push(info);\n              }\n            }\n          }\n        });\n\n      return result;\n    };\n\n    const info = computed(() => getCatalogInfo());\n\n    return (): VNode =>\n      h(\"div\", { class: \"catalog-wrapper\" }, [\n        h(\"h2\", { class: \"main-title\" }, locale.value.title),\n\n        ...info.value.map(({ children = [], icon, path, title }, mainIndex) => [\n          h(\n            \"h3\",\n            {\n              id: title,\n              class: [\"child-title\", { \"has-children\": children.length }],\n            },\n            [\n              h(\"a\", { href: `#${title}`, class: \"header-anchor\" }, \"#\"),\n              h(RouterLink, { class: \"catalog-title\", to: path }, () => [\n                icon ? h(FontIcon, { icon }) : null,\n                `${mainIndex + 1}. ${title || \"Unknown\"}`,\n              ]),\n            ]\n          ),\n          children.length\n            ? h(\n                \"ul\",\n                { class: \"child-catalog-wrapper\" },\n                children.map(({ children = [], icon, path, title }, index) =>\n                  h(\"li\", { class: \"child-catalog-item\" }, [\n                    h(\n                      \"div\",\n                      {\n                        class: [\n                          \"sub-title\",\n                          { \"has-children\": children.length },\n                        ],\n                      },\n                      [\n                        h(\n                          \"a\",\n                          { href: `#${title}`, class: \"header-anchor\" },\n                          \"#\"\n                        ),\n                        h(\n                          RouterLink,\n                          { class: \"catalog-title\", to: path },\n                          () => [\n                            icon ? h(FontIcon, { icon }) : null,\n                            `${mainIndex + 1}.${index + 1} ${\n                              title || \"Unknown\"\n                            }`,\n                          ]\n                        ),\n                      ]\n                    ),\n                    children.length\n                      ? h(\n                          \"div\",\n                          { class: \"sub-catalog-wrapper\" },\n                          children.map(({ icon, path, title }, subIndex) =>\n                            h(\n                              RouterLink,\n                              {\n                                class: \"sub-catalog-item\",\n                                to: path,\n                              },\n                              () => [\n                                icon ? h(FontIcon, { icon }) : null,\n                                `${mainIndex + 1}.${index + 1}.${\n                                  subIndex + 1\n                                } ${title || \"Unknown\"}`,\n                              ]\n                            )\n                          )\n                        )\n                      : null,\n                  ])\n                )\n              )\n            : null,\n        ]),\n      ]);\n  },\n});\n"],"names":["m","defineComponent","props","style","computed","styleObject","h","Catalog","meta","locale","useLocaleConfig","route","useRoute","router","useRouter","siteData","useSiteData","getCatalogInfo","base","routes","result","path","otherLocales","item","localePath","level","title","infoA","infoB","info","_a","parent","grandParent","children","icon","mainIndex","RouterLink","FontIcon","index","subIndex"],"mappings":"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"}