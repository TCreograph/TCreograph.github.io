const A=(s,t,h)=>{let n;const a=t,p={ok:!1,pos:t,value:""};for(n=s.charAt(t);t<h&&n.match(/\d/)||n==="%";)n=s.charAt(++t);return p.ok=!0,p.pos=t,p.value=s.slice(a,t),p},k=(s,t,h)=>{const n={ok:!1,pos:0,width:"",height:""};if(t>=h||s.charAt(t)!=="=")return n;t+=1;const a=s.charAt(t);if(a!=="x"&&!a.match(/\d/))return n;const p=A(s,t,h);if(t=p.pos,s.charAt(t)!=="x")return n;t+=1;const r=A(s,t,h);return t=r.pos,n.width=p.value,n.height=r.value,n.pos=t,n.ok=!0,n},g=(s,t)=>{const h=s.env,n=s.pos,a=s.posMax;if(s.src.charAt(s.pos)!=="!"||s.src.charAt(s.pos+1)!=="[")return!1;const p=s.pos+2,r=s.md.helpers.parseLinkLabel(s,s.pos+1,!1);if(r<0)return!1;let e=r+1,o,f="",u="",m="",d="";if(e<a&&s.src.charAt(e)==="("){for(e+=1;e<a&&(o=s.src.charAt(e),!(o!==" "&&o!=="	"));e++);if(e>=a)return!1;let c;c=s.md.helpers.parseLinkDestination(s.src,e,s.posMax),c.ok&&(f=s.md.normalizeLink(c.str),s.md.validateLink(f)?e=c.pos:f="");const i=e;for(;e<a&&(o=s.src.charAt(e),!(o!==" "&&o!=="	"));e++);if(c=s.md.helpers.parseLinkTitle(s.src,e,s.posMax),e<a&&i!==e&&c.ok)for(u=c.str,e=c.pos;e<a&&(o=s.src.charAt(e),!(o!==" "&&o!=="	"));e++);else u="";if(e-1>=0&&(o=s.src.charAt(e-1),o===" "&&(c=k(s.src,e,s.posMax),c.ok)))for(m=c.width,d=c.height,e=c.pos;e<a&&(o=s.src.charAt(e),!(o!==" "&&o!==`
`));e++);if(e>=a||s.src.charAt(e)!==")")return s.pos=n,!1;e+=1}else{let c="";if(typeof h.references>"u")return!1;for(;e<a&&(o=s.src.charAt(e),!(o!==" "&&o!=="	"));e++);if(e<a&&s.src.charAt(e)==="["){const l=e+1;e=s.md.helpers.parseLinkLabel(s,e),e>=0?c=s.src.slice(l,e++):e=r+1}else e=r+1;c||(c=s.src.slice(p,r));const i=h.references[s.md.utils.normalizeReference(c)];if(!i)return s.pos=n,!1;f=i.href,u=i.title||""}if(!t){s.pos=p,s.posMax=r;const c=s.src.slice(p,r),i=[];s.md.inline.parse(c,s.md,s.env,i);const l=s.push("image","img",0);l.attrs=[["src",f],["alt",""]],u&&l.attrs.push(["title",u]),m!==""&&l.attrs.push(["width",m]),d!==""&&l.attrs.push(["height",d]),l.children=i,l.content=c}return s.pos=e,s.posMax=a,!0},x=s=>{s.inline.ruler.before("emphasis","image",g)};export{x as imgSize};
//# sourceMappingURL=index.mjs.map
