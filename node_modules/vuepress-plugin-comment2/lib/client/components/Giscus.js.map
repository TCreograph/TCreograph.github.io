{"version":3,"file":"Giscus.js","sources":["../../../src/client/components/Giscus.ts"],"sourcesContent":["import { usePageFrontmatter, usePageLang, withBase } from \"@vuepress/client\";\nimport { computed, defineComponent, h, onMounted, ref } from \"vue\";\nimport { useRoute } from \"vue-router\";\n\nimport type { VNode } from \"vue\";\nimport type {\n  CommentPluginFrontmatter,\n  GiscusInputPosition,\n  GiscusMapping,\n  GiscusOptions,\n  GiscusRepo,\n  GiscusTheme,\n} from \"../../shared/index.js\";\n\nimport \"../styles/giscus.scss\";\n\ndeclare const COMMENT_OPTIONS: GiscusOptions;\n\nconst SUPPORTED_LANGUAGES = [\n  \"de\",\n  \"gsw\",\n  \"en\",\n  \"es\",\n  \"fr\",\n  \"id\",\n  \"it\",\n  \"ja\",\n  \"ko\",\n  \"pl\",\n  \"ro\",\n  \"ru\",\n  \"tr\",\n  \"vi\",\n  \"zh-CN\",\n  \"zh-TW\",\n] as const;\n\ntype BooleanString = \"0\" | \"1\";\n\nexport type GiscusLang = (typeof SUPPORTED_LANGUAGES)[number];\n\nexport type GiscusLoading = \"lazy\" | \"eager\";\n\nexport interface GiscusProps {\n  id?: string | undefined;\n  repo: GiscusRepo;\n  repoId: string;\n  category?: string | undefined;\n  categoryId?: string | undefined;\n  mapping: GiscusMapping;\n  term?: string | undefined;\n  theme?: GiscusTheme | undefined;\n  reactionsEnabled?: BooleanString | undefined;\n  strict?: BooleanString | undefined;\n  emitMetadata?: BooleanString | undefined;\n  inputPosition?: GiscusInputPosition | undefined;\n  lang?: GiscusLang | undefined;\n  loading?: GiscusLoading | undefined;\n}\n\nconst giscusOption = COMMENT_OPTIONS;\nconst enableGiscus = Boolean(\n  giscusOption.repo &&\n    giscusOption.repoId &&\n    giscusOption.category &&\n    giscusOption.categoryId\n);\n\nconst { repo, repoId, category, categoryId } = giscusOption;\n\nexport default defineComponent({\n  name: \"GiscusComment\",\n\n  props: {\n    /**\n     * Whether the component is in darkmode\n     *\n     * 组件是否处于夜间模式\n     */\n    darkmode: Boolean,\n  },\n\n  setup(props) {\n    const frontmatter = usePageFrontmatter<CommentPluginFrontmatter>();\n    const route = useRoute();\n    const loaded = ref(false);\n\n    const giscusLang = computed(() => {\n      const lang = usePageLang().value as GiscusLang;\n\n      if (SUPPORTED_LANGUAGES.includes(lang)) return lang;\n\n      const shortCode = lang.split(\"-\")[0] as GiscusLang;\n\n      if (SUPPORTED_LANGUAGES.includes(shortCode)) return shortCode;\n\n      return \"en\";\n    });\n\n    const enableComment = computed(() => {\n      if (!enableGiscus) return false;\n      const pluginConfig = giscusOption.comment !== false;\n      const pageConfig = frontmatter.value.comment;\n\n      return (\n        // Enable in page\n        Boolean(pageConfig) ||\n        // not disabled in anywhere\n        (pluginConfig !== false && pageConfig !== false)\n      );\n    });\n\n    const config = computed<GiscusProps>(() => ({\n      repo,\n      repoId,\n      category,\n      categoryId,\n      lang: giscusLang.value,\n      theme: props.darkmode\n        ? giscusOption.darkTheme || \"dark\"\n        : giscusOption.lightTheme || \"light\",\n      mapping: giscusOption.mapping || \"pathname\",\n      term: withBase(route.path),\n      inputPosition: giscusOption.inputPosition || \"top\",\n      reactionsEnabled: giscusOption.reactionsEnabled === false ? \"0\" : \"1\",\n      strict: giscusOption.strict === false ? \"0\" : \"1\",\n      loading: giscusOption.lazyLoading === false ? \"eager\" : \"lazy\",\n      emitMetadata: \"0\",\n    }));\n\n    onMounted(async () => {\n      await import(\"giscus\");\n      loaded.value = true;\n    });\n\n    return (): VNode =>\n      h(\n        \"div\",\n        {\n          class: [\n            \"giscus-wrapper\",\n            { \"input-top\": giscusOption.inputPosition !== \"bottom\" },\n          ],\n          id: \"comment\",\n          style: {\n            display: enableComment.value ? \"block\" : \"none\",\n          },\n        },\n        loaded.value\n          ? h(\"giscus-widget\", config.value)\n          : h(\"div\", { style: \"text-align:center\" }, \"Loading...\")\n      );\n  },\n});\n"],"names":["SUPPORTED_LANGUAGES","giscusOption","enableGiscus","repo","repoId","category","categoryId","Giscus","defineComponent","props","frontmatter","usePageFrontmatter","route","useRoute","loaded","ref","giscusLang","computed","lang","usePageLang","shortCode","enableComment","pluginConfig","pageConfig","config","withBase","onMounted","h"],"mappings":"4OAkBA,MAAMA,EAAsB,CAC1B,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,QACA,OACF,EAyBMC,EAAe,gBACfC,EAAe,QACnBD,EAAa,MACXA,EAAa,QACbA,EAAa,UACbA,EAAa,UACjB,EAEM,CAAE,KAAAE,EAAM,OAAAC,EAAQ,SAAAC,EAAU,WAAAC,CAAW,EAAIL,EAE/C,IAAAM,EAAeC,EAAgB,CAC7B,KAAM,gBAEN,MAAO,CAML,SAAU,OACZ,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAcC,IACdC,EAAQC,EAAS,EACjBC,EAASC,EAAI,EAAK,EAElBC,EAAaC,EAAS,IAAM,CAChC,MAAMC,EAAOC,EAAc,EAAA,MAE3B,GAAInB,EAAoB,SAASkB,CAAI,EAAG,OAAOA,EAE/C,MAAME,EAAYF,EAAK,MAAM,GAAG,EAAE,CAAC,EAEnC,OAAIlB,EAAoB,SAASoB,CAAS,EAAUA,EAE7C,IACT,CAAC,EAEKC,EAAgBJ,EAAS,IAAM,CACnC,GAAI,CAACf,EAAc,MAAO,GAC1B,MAAMoB,EAAerB,EAAa,UAAY,GACxCsB,EAAab,EAAY,MAAM,QAErC,OAEE,QAAQa,CAAU,GAEjBD,IAAiB,IAASC,IAAe,EAE9C,CAAC,EAEKC,EAASP,EAAsB,KAAO,CAC1C,KAAAd,EACA,OAAAC,EACA,SAAAC,EACA,WAAAC,EACA,KAAMU,EAAW,MACjB,MAAOP,EAAM,SACTR,EAAa,WAAa,OAC1BA,EAAa,YAAc,QAC/B,QAASA,EAAa,SAAW,WACjC,KAAMwB,EAASb,EAAM,IAAI,EACzB,cAAeX,EAAa,eAAiB,MAC7C,iBAAkBA,EAAa,mBAAqB,GAAQ,IAAM,IAClE,OAAQA,EAAa,SAAW,GAAQ,IAAM,IAC9C,QAASA,EAAa,cAAgB,GAAQ,QAAU,OACxD,aAAc,GAChB,EAAE,EAEF,OAAAyB,EAAU,SAAY,CACpB,KAAM,QAAO,QAAQ,EACrBZ,EAAO,MAAQ,EACjB,CAAC,EAEM,IACLa,EACE,MACA,CACE,MAAO,CACL,iBACA,CAAE,YAAa1B,EAAa,gBAAkB,QAAS,CACzD,EACA,GAAI,UACJ,MAAO,CACL,QAASoB,EAAc,MAAQ,QAAU,MAC3C,CACF,EACAP,EAAO,MACHa,EAAE,gBAAiBH,EAAO,KAAK,EAC/BG,EAAE,MAAO,CAAE,MAAO,mBAAoB,EAAG,YAAY,CAC3D,CACJ,CACF,CAAC"}