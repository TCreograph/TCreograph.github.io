{"version":3,"file":"index.js","sources":["../../src/node/locales.ts","../../src/node/utils.ts","../../src/node/alias.ts","../../src/node/compact.ts","../../src/node/plugin.ts"],"sourcesContent":["import type { WalineLocaleConfig } from \"../shared/index.js\";\n\n/**\n * Default locale config for Waline\n */\nexport const walineLocales: WalineLocaleConfig = {\n  \"/en/\": {\n    placeholder:\n      \"Write a comment here (Fill in the email address to receive an email notification when being replied)\",\n  },\n\n  \"/zh/\": {\n    placeholder: \"请留言。(填写邮箱可在被回复时收到邮件提醒)\",\n  },\n\n  \"/zh-tw/\": {\n    placeholder: \"請留言。(填寫信箱可在被回覆時收到郵件提醒)\",\n  },\n\n  \"/de/\": {\n    placeholder:\n      \"Schreibe ein Kommentar (Geben Sie die E-Mail-Adresse ein, um eine E-Mail-Benachrichtigung zu erhalten, wenn Sie eine Antwort erhalten)\",\n  },\n\n  \"/de-at/\": {\n    placeholder:\n      \"Schreibe ein Kommentar (Geben Sie die E-Mail-Adresse ein, um eine E-Mail-Benachrichtigung zu erhalten, wenn Sie eine Antwort erhalten)\",\n  },\n\n  \"/vi/\": {\n    placeholder:\n      \"Để lại bình luận (Điền địa chỉ email để nhận email thông báo khi được trả lời)\",\n  },\n\n  \"/uk/\": {\n    placeholder:\n      \"Напишіть тут коментар (введіть адресу електронної пошти, щоб отримувати сповіщення електронною поштою, коли буде відповідь)\",\n  },\n\n  \"/ru/\": {\n    placeholder:\n      \"Напишите комментарий здесь (Введите адрес электронной почты, чтобы получить уведомление по электронной почте при ответе)\",\n  },\n\n  \"/br/\": {\n    placeholder:\n      \"Escreva um comentário aqui (preencha com o endereço de email para receber notificações quando tiver alguma resposta)\",\n  },\n\n  \"/pl/\": {\n    placeholder:\n      \"Wpisz tutaj komentarz (wpisz adres e-mail, aby otrzymać powiadomienie e-mail, gdy otrzymasz odpowiedź)\",\n  },\n\n  \"/sk/\": {\n    placeholder:\n      \"Napíš svoj komentár (vlož svoj e-mail taktiež, aby si bol notifikovaný o odpovediach)\",\n  },\n\n  \"/fr/\": {\n    placeholder:\n      \"Écrivez votre commentaire ici (Inscrivez votre email afin de recevoir une notification en cas de réponse)\",\n  },\n\n  \"/es/\": {\n    placeholder:\n      \"Escriba un comentario aquí (Ingrese su correo electrónico para recibir una notificación en caso de respuesta)\",\n  },\n\n  \"/ja/\": {\n    placeholder:\n      \"伝言をどうぞ (メールアドレスを入力すると、返信があった際にメールでお知らせします。)\",\n  },\n\n  \"/tr/\": {\n    placeholder:\n      \"Buraya bir yorum yazın (Yanıtlandığında bir e-posta bildirimi almak için e-posta adresinizi girin)\",\n  },\n\n  \"/ko/\": {\n    placeholder:\n      \"댓글을 남겨주세요 (답변이 있을 경우 이메일로 알림을 받으려면 이메일 주소를 입력하세요)\",\n  },\n\n  \"/fi/\": {\n    placeholder:\n      \"Kirjoita kommentti tähän (täytä sähköpostiosoite saadaksesi sähköposti-ilmoituksen vastauksesta)\",\n  },\n};\n","import { ensureEndingSlash } from \"@vuepress/shared\";\nimport { getDirname, path } from \"@vuepress/utils\";\nimport { Logger } from \"vuepress-shared/node\";\n\nconst __dirname = getDirname(import.meta.url);\n\nexport const CLIENT_FOLDER = ensureEndingSlash(\n  path.resolve(__dirname, \"../client\")\n);\n\nexport const logger = new Logger(\"vuepress-plugin-comment2\");\n","import { CLIENT_FOLDER, logger } from \"./utils.js\";\nimport { noopModule } from \"vuepress-shared/node\";\n\nexport const getProvider = (provider = \"None\"): string => {\n  if ([\"Waline\", \"Giscus\", \"Twikoo\"].includes(provider))\n    return `${CLIENT_FOLDER}components/${provider}.js`;\n\n  if (provider !== \"None\") logger.error(`Invalid provider: ${provider}`);\n\n  return noopModule;\n};\n","import { logger } from \"./utils.js\";\nimport type { CommentOptions } from \"../shared/index.js\";\n\n/** @deprecated */\nexport const convertOptions = (\n  options: CommentOptions & {\n    /** @deprecated */\n    type?: \"waline\" | \"giscus\" | \"twikoo\" | \"none\";\n  }\n): void => {\n  // v2 changes\n  if (\"type\" in options) {\n    logger.warn(`\"type\" is deprecated, please use \"provider\".`);\n\n    if (options[\"type\"] === \"waline\") options.provider = \"Waline\";\n    else if (options[\"type\"] === \"giscus\") options.provider = \"Giscus\";\n    else if (options[\"type\"] === \"twikoo\") options.provider = \"Twikoo\";\n\n    delete options[\"type\"];\n  }\n\n  // convert Waline options\n  if (options.provider === \"Waline\") {\n    [\n      // valine\n      [\"emojiCDN\", \"emoji\"],\n      [\"emojiMaps\", \"emoji\"],\n      [\"requiredFields\", \"requiredMeta\"],\n      [\"visitor\", \"pageview\"],\n      [\"langMode\", \"locale\"],\n      [\"placeholder\", \"locale.placeholder\"],\n\n      // waline v1\n      [\"anonymous\", \"login\"],\n      [\"copyRight\", \"copyright\"],\n    ].forEach(([oldOptions, newOptions]) => {\n      if (oldOptions in options) {\n        logger.warn(\n          `\"${oldOptions}\" is deprecated in @waline/client@v2, you should use \"${newOptions}\" instead.`\n        );\n\n        // @ts-ignore\n        delete options[oldOptions];\n      }\n    });\n\n    [\n      // valine\n      \"region\",\n      \"appId\",\n      \"appKey\",\n      \"notify\",\n      \"verify\",\n      \"avatar\",\n      \"avatarForce\",\n      \"enableQQ\",\n      \"recordIP\",\n      \"serverURLs\",\n\n      // waline v1\n      \"avatarCDN\",\n      \"mathTagSupport\",\n      \"highlight\",\n      \"uploadImage\",\n      \"previewMath\",\n    ].forEach((option) => {\n      if (option in options) {\n        logger.error(\n          `\"${option}\" is no longer supported in @waline/client@v2.`\n        );\n\n        // @ts-ignore\n        delete options[option];\n      }\n    });\n  }\n};\n","import { getDirname, path } from \"@vuepress/utils\";\nimport { useSassPalettePlugin } from \"vuepress-plugin-sass-palette\";\nimport {\n  addCustomElement,\n  addViteOptimizeDepsExclude,\n  addViteOptimizeDepsInclude,\n  addViteSsrExternal,\n  getLocales,\n} from \"vuepress-shared/node\";\n\nimport { getProvider } from \"./alias.js\";\nimport { convertOptions } from \"./compact.js\";\nimport { walineLocales } from \"./locales.js\";\nimport { logger } from \"./utils.js\";\n\nimport type { CommentOptions } from \"../shared/index.js\";\nimport type { PluginFunction } from \"@vuepress/core\";\n\nconst __dirname = getDirname(import.meta.url);\n\n/** Comment Plugin */\nexport const commentPlugin =\n  (options: CommentOptions, legacy = true): PluginFunction =>\n  (app) => {\n    // TODO: Remove this in v2 stable\n    if (legacy)\n      convertOptions(options as CommentOptions & Record<string, unknown>);\n    if (app.env.isDebug) logger.info(\"Options:\", options);\n\n    const provider =\n      options.provider &&\n      [\"Giscus\", \"Waline\", \"Twikoo\"].includes(options.provider)\n        ? options.provider\n        : \"None\";\n\n    const userWalineLocales =\n      options.provider === \"Waline\"\n        ? getLocales({\n            app,\n            name: \"waline\",\n            default: walineLocales,\n            config: options.locales,\n          })\n        : {};\n\n    // remove locales so that they won’t be injected in client twice\n    if (options.provider === \"Waline\" && \"locales\" in options)\n      delete options.locales;\n\n    useSassPalettePlugin(app, { id: \"hope\" });\n\n    return {\n      name: \"vuepress-plugin-comment2\",\n\n      alias: {\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        \"vuepress-plugin-comment2/provider\": getProvider(options.provider),\n      },\n\n      define: () => ({\n        COMMENT_OPTIONS: options,\n        ...(options.provider === \"Waline\"\n          ? {\n              WALINE_LOCALES: userWalineLocales,\n              WALINE_META: options.metaIcon !== false,\n            }\n          : {}),\n      }),\n\n      extendsBundlerOptions: (bundlerOptions: unknown, app): void => {\n        if (provider === \"Giscus\") {\n          addCustomElement(bundlerOptions, app, \"GiscusWidget\");\n          addViteSsrExternal(bundlerOptions, app, \"giscus\");\n        }\n\n        if (provider === \"Waline\") {\n          addViteOptimizeDepsInclude(bundlerOptions, app, \"autosize\");\n          addViteOptimizeDepsExclude(bundlerOptions, app, \"@waline/client\");\n          addViteSsrExternal(bundlerOptions, app, \"@waline/client\");\n        }\n\n        if (provider === \"Twikoo\") {\n          addViteOptimizeDepsInclude(bundlerOptions, app, \"twikoo\");\n          addViteSsrExternal(bundlerOptions, app, \"twikoo\");\n        }\n      },\n\n      clientConfigFile: path.resolve(__dirname, \"../client/config.js\"),\n    };\n  };\n"],"names":["walineLocales","__dirname","getDirname","CLIENT_FOLDER","ensureEndingSlash","path","logger","Logger","getProvider","provider","noopModule","convertOptions","options","oldOptions","newOptions","option","commentPlugin","legacy","app","userWalineLocales","getLocales","useSassPalettePlugin","bundlerOptions","addCustomElement","addViteSsrExternal","addViteOptimizeDepsInclude","addViteOptimizeDepsExclude"],"mappings":"4WAKO,MAAMA,EAAoC,CAC/C,OAAQ,CACN,YACE,sGACJ,EAEA,OAAQ,CACN,YAAa,wBACf,EAEA,UAAW,CACT,YAAa,wBACf,EAEA,OAAQ,CACN,YACE,wIACJ,EAEA,UAAW,CACT,YACE,wIACJ,EAEA,OAAQ,CACN,YACE,gFACJ,EAEA,OAAQ,CACN,YACE,6HACJ,EAEA,OAAQ,CACN,YACE,0HACJ,EAEA,OAAQ,CACN,YACE,sHACJ,EAEA,OAAQ,CACN,YACE,wGACJ,EAEA,OAAQ,CACN,YACE,uFACJ,EAEA,OAAQ,CACN,YACE,2GACJ,EAEA,OAAQ,CACN,YACE,+GACJ,EAEA,OAAQ,CACN,YACE,6CACJ,EAEA,OAAQ,CACN,YACE,oGACJ,EAEA,OAAQ,CACN,YACE,mDACJ,EAEA,OAAQ,CACN,YACE,kGACJ,CACF,ECpFMC,EAAYC,EAAW,YAAY,GAAG,EAE/BC,EAAgBC,EAC3BC,EAAK,QAAQJ,EAAW,WAAW,CACrC,EAEaK,EAAS,IAAIC,EAAO,0BAA0B,ECP9CC,EAAc,CAACC,EAAW,SACjC,CAAC,SAAU,SAAU,QAAQ,EAAE,SAASA,CAAQ,EAC3C,GAAGN,eAA2BM,QAEnCA,IAAa,QAAQH,EAAO,MAAM,qBAAqBG,GAAU,EAE9DC,GCLIC,EACXC,GAIS,CAEL,SAAUA,IACZN,EAAO,KAAK,8CAA8C,EAEtDM,EAAQ,OAAY,SAAUA,EAAQ,SAAW,SAC5CA,EAAQ,OAAY,SAAUA,EAAQ,SAAW,SACjDA,EAAQ,OAAY,WAAUA,EAAQ,SAAW,UAE1D,OAAOA,EAAQ,MAIbA,EAAQ,WAAa,WACvB,CAEE,CAAC,WAAY,OAAO,EACpB,CAAC,YAAa,OAAO,EACrB,CAAC,iBAAkB,cAAc,EACjC,CAAC,UAAW,UAAU,EACtB,CAAC,WAAY,QAAQ,EACrB,CAAC,cAAe,oBAAoB,EAGpC,CAAC,YAAa,OAAO,EACrB,CAAC,YAAa,WAAW,CAC3B,EAAE,QAAQ,CAAC,CAACC,EAAYC,CAAU,IAAM,CAClCD,KAAcD,IAChBN,EAAO,KACL,IAAIO,0DAAmEC,aACzE,EAGA,OAAOF,EAAQC,CAAU,EAE7B,CAAC,EAED,CAEE,SACA,QACA,SACA,SACA,SACA,SACA,cACA,WACA,WACA,aAGA,YACA,iBACA,YACA,cACA,aACF,EAAE,QAASE,GAAW,CAChBA,KAAUH,IACZN,EAAO,MACL,IAAIS,iDACN,EAGA,OAAOH,EAAQG,CAAM,EAEzB,CAAC,EAEL,EC1DMd,EAAYC,EAAW,YAAY,GAAG,EAG/Bc,EACX,CAACJ,EAAyBK,EAAS,KAClCC,GAAQ,CAEHD,GACFN,EAAeC,CAAmD,EAChEM,EAAI,IAAI,SAASZ,EAAO,KAAK,WAAYM,CAAO,EAEpD,MAAMH,EACJG,EAAQ,UACR,CAAC,SAAU,SAAU,QAAQ,EAAE,SAASA,EAAQ,QAAQ,EACpDA,EAAQ,SACR,OAEAO,EACJP,EAAQ,WAAa,SACjBQ,EAAW,CACT,IAAAF,EACA,KAAM,SACN,QAASlB,EACT,OAAQY,EAAQ,OAClB,CAAC,EACD,CAGN,EAAA,OAAIA,EAAQ,WAAa,UAAY,YAAaA,GAChD,OAAOA,EAAQ,QAEjBS,EAAqBH,EAAK,CAAE,GAAI,MAAO,CAAC,EAEjC,CACL,KAAM,2BAEN,MAAO,CAEL,oCAAqCV,EAAYI,EAAQ,QAAQ,CACnE,EAEA,OAAQ,KAAO,CACb,gBAAiBA,EACjB,GAAIA,EAAQ,WAAa,SACrB,CACE,eAAgBO,EAChB,YAAaP,EAAQ,WAAa,EACpC,EACA,CAAA,CACN,GAEA,sBAAuB,CAACU,EAAyBJ,IAAc,CACzDT,IAAa,WACfc,EAAiBD,EAAgBJ,EAAK,cAAc,EACpDM,EAAmBF,EAAgBJ,EAAK,QAAQ,GAG9CT,IAAa,WACfgB,EAA2BH,EAAgBJ,EAAK,UAAU,EAC1DQ,EAA2BJ,EAAgBJ,EAAK,gBAAgB,EAChEM,EAAmBF,EAAgBJ,EAAK,gBAAgB,GAGtDT,IAAa,WACfgB,EAA2BH,EAAgBJ,EAAK,QAAQ,EACxDM,EAAmBF,EAAgBJ,EAAK,QAAQ,EAEpD,EAEA,iBAAkBb,EAAK,QAAQJ,EAAW,qBAAqB,CACjE,CACF"}